        {% assign isSpecial = false %}

        {% assign product =  thisproduct %}
        {% assign productObj =  all_products[product] %}
        {%- assign has_variants = false -%}

        {%- unless product.has_only_default_variant -%}
            {%- assign has_variants = true -%}
        {%- endunless -%}
        {%- assign current_variant = product.selected_or_first_available_variant -%}

        {% assign crawlcheck = false %}
        {% if product.metafields.plytix.package_products %}
            {% assign crawlcheck = true %}
        {% endif %}

        {% assign discontinued = false %}
        {% for c in all_products[product.handle].collections %}
            {% if c.handle == "discontinued" %}
                {% assign discontinued = true %}
                {% comment %}{% assign crawlcheck = true %}{% endcomment %}
            {% endif %}
        {% endfor %}

        {% assign showatc = true %}


        {% if crawlcheck == true %}
            <div style="display:none;" class="crawlcheck crawlcheck-related"><!-- check product that is supposed to be here for discontinued or broken handle ({{ product_handle }})--></div>
        {% endif %}
        <div class="returned-product" id="b2blist-product-{{ product.id }}" data-producttype="{{ product.type }}">
                <div class="b2b-col b2b-product-check" >

                    {% if product.metafields.plytix.package_products != blank or product.metafields.plytix.packaged_free_product != blank %}
                        {% assign showatc = false %}
                        <span style="display:none">Package</span>
                    {% else %}
                        {% if product.metafields.plytix.hide_pricing != 'Hide Button Only' and product.metafields.plytix.hide_pricing != 'Hide Price and Button' %}
                            <input type="checkbox" class="b2blist-check"  aria-label="Include {{ product_title | escape }}" >
                        {% else %}
                            {% assign showatc = false %}
                            <span style="display:none">atc hidden</span>
                        {% endif %}
                    {% endif %}
                </div>
                <div class="b2b-col b2b-product-image" >
                    <a href="/products/{{ product.handle }}">{{ product.featured_image | img_url: '40x40' | img_tag: product.featured_image.alt }}</a>
                </div>
                <div class="b2b-col b2b-product-title" data-part-title >
                    <a href="/products/{{ product.handle }}">{{ product.title }}</a>
                    <div class="option-name">
                        {% for variant in product.variants %}
                            <div class="b2blist-var{{ variant.id }} b2blist-var-variables {% if current_variant.id == variant.id and has_variants == false %}current-b2blist-var{% endif %}">
                                <div class="b2blist-detail-sku"><strong>SKU:</strong> {{ variant.sku }}</div>
                            </div>
                        {% endfor %}



                        {%- if has_variants == true %}
                            {% comment %}Dropdown for variations{% endcomment %}
                            <div class="b2blist-select-contain">
                                {% for option in product.options_with_values %}
                                    {{ option.name }}:
                                {% endfor %}

                                <select class="b2blist-var-select" id="b2blist-var-select-{{ product.id }}">
                                    <option value="">Choose Option</option>
                                    {% for variant in product.variants %}
                                        {% comment %}SKU:<span> {{ variant.id }}{{ variant.sku }}{{ variant.title }} </span>{% endcomment %}
                                        <option value="{{ variant.id }}" >{{ variant.title }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        {%- endif -%}
                    </div>


                </div>

                <div class="b2b-col b2b-product-price">


                    {% comment %}start of data-------------------------------------------------------------------------------------------------------{% endcomment %}

                    {% for variant in product.variants %}
                        {%- comment -%}Get stock status for logging in order at time of order --------------------------------------------------------------------{%- endcomment -%}

                        {%- assign stockStatusMain = "" -%}
                        {%- assign stockStatusSub = "" -%}
                        {%- assign fservice = variant.fulfillment_service -%}
                        {%- assign leadTime = variant.metafields.plytix.sxerp_lead_time -%}
                        {%- assign inventoryQuantity = variant.inventory_quantity -%}
                        {%- assign inventoryQuantity = inventoryQuantity | plus: 0 -%}
                        {%- assign leadTime = leadTime | plus: 0 -%}

                        {%- if variant.metafields.plytix.sx_erp_is_drop_ship == 'true' and  inventoryQuantity <  1 -%}
                            {%- assign stockStatusMain = "Ships Direct from Manufacturer" -%}
                            {%- assign stockStatusSub = "May Have Extended Lead Times" -%}
                        {%- elsif variant.inventory_management == 'middleware-fulfillment' and  inventoryQuantity <  1 -%}

                            {% comment %}Look at po date instead of lead time{% endcomment %}
                            {%- if variant.metafields.plytix.sxerp_po_date -%}
                                {% assign dateStart = variant.metafields.plytix.sxerp_po_date | date: '%s' %}
                                {% assign nowTimestamp = 'now' | date: '%s' %}
                                {% assign diffSeconds = dateStart | minus: nowTimestamp %}
                                {% assign leadTime = diffSeconds | divided_by: 3600 | divided_by: 24 %}
                            {%- endif -%}

                            {%- assign stockStatusMain = "Temporarily On Backorder" -%}
                            {%- if leadTime < 22  -%}
                                {%- assign stockStatusSub = "Estimated Ship Date 1 – 3 wks" -%}
                            {%- elsif leadTime < 29 -%}
                                {%- assign stockStatusSub = "Estimated Ship Date 2 – 4 wks" -%}
                            {%- elsif leadTime < 36 -%}
                                {%- assign stockStatusSub = "Estimated Ship Date 3 – 5 wks" -%}
                            {%- elsif leadTime < 43 -%}
                                {%- assign stockStatusSub = "Estimated Ship Date 4 –6 wks" -%}
                            {%- elsif leadTime < 50 -%}
                                {%- assign stockStatusSub = "Estimated Ship Date 5 – 7 wks" -%}
                            {%- elsif leadTime < 57 -%}
                                {%- assign stockStatusSub = "Estimated Ship Date 6 – 8 wks" -%}
                            {%- elsif leadTime < 64 -%}
                                {%- assign stockStatusSub = "Estimated Ship Date 7 – 9 wks" -%}
                            {%- elsif leadTime < 71 -%}
                                {%- assign stockStatusSub = "Estimated Ship Date 8 – 10 wks" -%}
                            {%- elsif leadTime < 78 -%}
                                {%- assign stockStatusSub = "Estimated Ship Date 9 – 11 wks" -%}
                            {%- elsif leadTime < 85 -%}
                                {%- assign stockStatusSub = "Estimated Ship Date 10 – 12 wks" -%}
                            {%- elsif leadTime < 121 -%}
                                {%- assign stockStatusSub = "Estimated Ship Date 3 – 4 mths" -%}
                            {%- elsif leadTime < 151 -%}
                                {%- assign stockStatusSub = "Estimated Ship Date 4 – 5 mths" -%}
                            {%- elsif leadTime < 181 -%}
                                {%- assign stockStatusSub = "Estimated Ship Date 5 – 6 mths" -%}
                            {%- elsif leadTime < 211 -%}
                                {%- assign stockStatusSub = "Estimated Ship Date 6 – 7 mths" -%}
                            {%- elsif leadTime < 1000 -%}
                                {%- assign stockStatusSub = "Estimated Ship Date over 7 mths" -%}
                            {%- endif -%}
                        {%- elsif variant.inventory_management == nil and leadTime -%}
                            {%- assign stockStatusMain = "Special Order Item" -%}
                            {%- if leadTime < 22  -%}
                                {%- assign stockStatusSub = "Expected to ship in 1 – 3 wks" -%}
                            {%- elsif leadTime < 29 -%}
                                {%- assign stockStatusSub = "Expected to ship in 2 – 4 wks" -%}
                            {%- elsif leadTime < 36 -%}
                                {%- assign stockStatusSub = "Expected to ship in 3 – 5 wks" -%}
                            {%- elsif leadTime < 43 -%}
                                {%- assign stockStatusSub = "Expected to ship in 4 – 6 wks" -%}
                            {%- elsif leadTime < 50 -%}
                                {%- assign stockStatusSub = "Expected to ship in 5 – 7 wks" -%}
                            {%- elsif leadTime < 57 -%}
                                {%- assign stockStatusSub = "Expected to ship in 6 – 8 wks" -%}
                            {%- elsif leadTime < 64 -%}
                                {%- assign stockStatusSub = "Expected to ship in 7 – 9 wks" -%}
                            {%- elsif leadTime < 71 -%}
                                {%- assign stockStatusSub = "Expected to ship in 8 – 10 wks" -%}
                            {%- elsif leadTime < 78 -%}
                                {%- assign stockStatusSub = "Expected to ship in 9 – 11 wks" -%}
                            {%- elsif leadTime < 85 -%}
                                {%- assign stockStatusSub = "Expected to ship in 10 – 12 wks" -%}
                            {%- elsif leadTime < 121 -%}
                                {%- assign stockStatusSub = "Expected to ship in 3 – 4 mths" -%}
                            {%- elsif leadTime < 151 -%}
                                {%- assign stockStatusSub = "Expected to ship in 4 – 5 mths" -%}
                            {%- elsif leadTime < 181 -%}
                                {%- assign stockStatusSub = "Expected to ship in 5 – 6 mths" -%}
                            {%- elsif leadTime < 211 -%}
                                {%- assign stockStatusSub = "Expected to ship in 6 – 7 mths" -%}
                            {%- elsif leadTime < 1000 -%}
                                {%- assign stockStatusSub = "Expected to ship in over 7 mths" -%}
                            {%- endif -%}
                        {%- elsif variant.inventory_quantity > 0 -%}
                            {%- assign stockStatusMain = "In Stock" -%}
                        {%- endif -%}

                        {%- if stockStatusSub != "" -%}
                            {%- capture stockStatusNote -%}{{ stockStatusMain }} ({{ stockStatusSub }}){%- endcapture -%}
                        {%- else -%}
                            {%- capture stockStatusNote -%}{{ stockStatusMain }}{%- endcapture -%}
                        {%- endif -%}
                        {%- comment -%}End of stock status logic ----------------------------------------------------------------------------------------------- {%- endcomment -%}

                        {% comment %}Print each of the variation values{% endcomment %}
                        <div class="b2blist-var{{ variant.id }} b2blist-var-variables {% if current_variant.id == variant.id and has_variants == false %}current-b2blist-var{% endif %}">
                            <div class="product-detail-sku" style="display:none;">SKU:<span>{{ variant.sku }}</span></div>
                            {%- if showatc == false -%}
                                <div class="productitem__price">
                                    <div class="see-item">See Product<br/>for Pricing</div>
                                </div>
                            {%- else -%}
                                {%- if product.metafields.plytix.hide_pricing != 'Hide Price Only (View in cart)' and product.metafields.plytix.hide_pricing != 'Hide Price and Button' -%}
                                    <div class="price productitem__price">


                                        {%- assign varfinalorgprice = nill -%}
                                        {%- assign varorgprice = variant.metafields.plytix.org-price-4-b2b | times: 100 -%}
                                        {%- assign varorgpriceb4special = variant.metafields.plytix.org-price-b4-special | times: 100 -%}
                                        {%- if varorgprice > variant.price -%}
                                            {%- assign isSpecial = true -%}
                                            {%- assign varfinalorgprice = varorgprice -%}
                                        {%- elsif varorgpriceb4special > variant.price -%}
                                            {%- assign isSpecial = true -%}
                                            {%- assign varfinalorgprice = varorgpriceb4special -%}
                                        {%- endif -%}

                                        {%- if isSpecial == true -%}

                                            <div class="price__current" data-price-container="" style=""><span class="money" data-price="{{ variant.price }}">{{ variant.price | money }}</span></div>

                                            {%- assign savings = varfinalorgprice | minus: variant.price -%}
                                            <div class="price__savings">You Saved: <span class="money">{{ savings | money }}</span></div>

                                        {%- else -%}
                                            <div class="price__current" data-price-container="" style=""><span class="money" data-price="{{ variant.price }}">{{ variant.price | money }}</span></div>
                                        {%- endif -%}
                                    </div>

                                {%- elsif product.metafields.plytix.hide_pricing == 'Hide Price Only (View in cart)' -%}
                                    <span style="font-size:14px; line-height:36px;">View Price in Cart</span>
                                {%- endif -%}
                            {%- endif -%}
                            <div class="b2blist-status" style="display:none;">{{ stockStatusNote }}</div>
                            <div id="data-b2blist-var{{ variant.id }}" class="b2blist-data {{ typeofitem }}"

                                 data-var_id="{{ variant.id }}"
                                 data-var_vissku="{{ variant.sku }}"
                                 data-var_status="{{ stockStatusNote }}"
                                 data-var_erpsku="{{ variant.metafields.plytix.erp_sku }}"
                                 data-producttype="{{ product.type }}"
                                 data-brand="{{ product.vendor }}"
                                    {% if variant.metafields.plytix.general_product_type == "Machine" %}
                                        data-sfeligible="true"
                                    {% endif %}
                                    {% if isSpecial == false %}
                                        {%- if variant.metafields.plytix.tiered_pricing != blank and variant.metafields.plytix.tiered_pricing_dollar_off != blank -%}
                                            data-var_tieredpricing="{{ variant.metafields.plytix.tiered_pricing }}:{{ variant.metafields.plytix.tiered_pricing_dollar_off | times: 100.00 | money_without_currency | replace: ",","" }}"
                                        {%- else -%}
                                            data-var_tieredpricing="{{ variant.metafields.plytix.tiered_pricing }}"
                                        {%- endif -%}
                                    {% endif %}
                                 data-var_availqty = "{{ variant.inventory_quantity }}"
                                 data-var_price="{{ variant.price }}"
                                 data-var_savings="{{ savings | money }}"
                                 data-b2blistbundle-subproduct
                                 style="display: none" ></div>
                        </div>
                    {% endfor %}


                    {% comment %}end of data---------------------------------------------------------------------------------------------------------------------{% endcomment %}


                    {% comment %}
                    <a href="/products/{{ product.handle }}">
                        {% if discontinued == true %}
                        <span class="single-price">Discontinued</span></a>
                    {% else %}
                        <span class="single-price">{{ productFirstVar.price | money }}</span></a>
                    {% endif %}
                    {% endcomment %}

                </div>

                {% comment %}Values for custom.js to pull to add to cart: changes on variation select{% endcomment %}
                {%- capture tiervalue -%}
                    {%- if current_variant.metafields.plytix.tiered_pricing != blank and current_variant.metafields.plytix.tiered_pricing_dollar_off != blank -%}
                        {{ current_variant.metafields.plytix.tiered_pricing }}:{{ current_variant.metafields.plytix.tiered_pricing_dollar_off | times: 100.00 | money_without_currency | replace: ",",""  }}
                    {%- else -%}
                        {{ current_variant.metafields.plytix.tiered_pricing }}
                    {%- endif -%}
                {%- endcapture -%}


                <div class="b2b-col b2b-product-qty">
                    {%- if showatc == true -%}
                    <input type="form-field-input form-field-number form-field-filled qty"
                           name="updates[{{ product.handle }}]"
                           class="product-data"
                           data-brand="{{ product.vendor }}"
                           data-producttype="{{ product.type }}"
                           data-freqbundle-subproduct
                           data-id="{{ current_variant.id }}"
                           data-availqty="{{ current_variant.inventory_quantity }}"
                           data-vissku="{{ current_variant.sku }}"
                           data-status="{{ stockStatusNote }}"
                           data-erpsku="{{ current_variant.metafields.plytix.erp_sku }}"
                           data-step="" data-tieredpricing="{{ tiervalue }}"
                           data-qty="1" data-price="{{ current_variant.price }}"
                            {% if product.metafields.plytix.general_product_type == "Machine" %}
                                data-sfeligible="true"
                            {% endif %}
                           value="1" />
                    {%- endif -%}
                </div>

                <div class="b2b-col b2b-atc-btn" >

                    {% if showatc == true %}
                        <div class="productitem--action-atc main-atc-button thinbtn" data-returned-product="b2blist-product-{{ product.id }}" data-b2blist-product-atc tabindex="0" onclick="">
                            <span class="atc-button--text"><span class="atc-plus">+</span>Add to cart</span>
                            <span class="atc-button--icon">{%- render 'icon-spinner' -%}</span>
                        </div>
                    {% else %}

                            <a class="" href="/products/{{ product.handle }}"><div class="productitem--action-atc main-atc-button thinbtn"><span class="atc-button--text">View Product <i class="fa-sharp fa-solid fa-caret-right"></i></span></div></a>

                    {% endif %}





                </div>
        </div>
