
{%- comment -%}
  B2B Company Summary + Location Selector
  Save as: snippets/b2b-company-summary.liquid
  Include with: {% render 'b2b-company-summary' %}

  What it does:
  - Shows customer name/email
  - Shows current company + "company address" based on current location
  - Shows a B2B location selector (sets active location using url_to_set_as_current)
  - Lists ALL available locations for the logged-in B2B customer (even if none is selected)
  - Shows payment terms per location (terms are location-based)
  - Loops company metafield custom.company_products (expected list.product) and prints
    product handle/title + variant SKUs
{%- endcomment -%}
{{ 'b2b-company-landing.css' | asset_url | stylesheet_tag }}
{{ 'b2b-scripts.js' | asset_url | script_tag }}

<div class="b2b-company-landing">
    {%- if customer and customer.b2b? -%}
        <div class="b2b-left-col">
            <div class="left-top-fix">


                <h2>Filter by Type</h2>
                <ul id="product-type-links">
                    <li><a href="/pages/b2b-product-list-quick-order">Loading...</a></li>
                    {% comment %}<li><a href="/pages/b2b-product-list-quick-order?product_type=Floor+Pads%2C+Bonnets+%26+Sanding+Screens">Floor Pads, Bonnets & Sanding Screens</a></li>{% endcomment %}
                    {% comment %}<li><a href="/pages/b2b-product-list-quick-order?product_type=Floor+Buffer+%26+Burnisher+Parts">Floor Buffer & Burnisher Parts</a></li>{% endcomment %}
                </ul>
                {% comment %}{% render 'b2b-company-product-list' %}{% endcomment %}



                <div class="list-atc-container">
                    <div class="add-selected productitem--action-atc main-atc-button b2b-atc-btn" tabindex="0" data-b2blist-productlist-atc >
                        <span class="atc-button--text"><span class="atc-plus">+</span> Add Selected</span>
                        <span class="atc-button--icon">{%- render 'icon-spinner' -%}</span>
                    </div>
                </div>

            </div>


        </div>
        <div class="b2b-right-col">
            <div class="b2b-summary-container">
                {% render 'b2b-company' %}
            </div>

            <div class="b2b-company-products-container">
                {% render 'b2b-company-product-list' %}
            </div>

        </div>


    {%- else -%}
        {%- if customer -%}
            <p><em>You are not part of a Company. Please contact us if you think this is not correct.</em></p>
        {%- else -%}
            <p><em>Please Log In.</em></p>
        {%- endif -%}
    {%- endif -%}


</div>





{% comment %}Location drop down option:
                           <h2>B2B Context</h2>
                           {%- if company_obj -%}
                               <p><strong>Company:</strong> {{ company_obj.name }}</p>
                           {%- else -%}
                               <p><em>No current company selected.</em></p>
                           {%- endif -%}

                           <h>Select a company location</h>

                           {%- if customer.company_available_locations_count and customer.company_available_locations_count > 0 -%}
                               {%- if current_loc -%}
                                   <p><strong>Current location:</strong> {{ current_loc.name }}</p>
                               {%- else -%}
                                   <p><em>No current location selected yet. Choose one below.</em></p>
                               {%- endif -%}

                               <form method="get" action="" class="b2b-location-selector" style="margin: 0 0 1rem 0;">
                                   <label for="b2bLocationSelect"><strong>Location</strong></label><br>
                                   <select id="b2bLocationSelect" name="b2b_location_select" onchange="if (this.value) window.location.href = this.value;">
                                       <option value="">{% if current_loc %}Change location{% else %}Select a location{% endif %}</option>
                                       {%- for loc in customer.company_available_locations -%}
                                           {%- assign is_current = false -%}
                                           {%- if current_loc and loc.id == current_loc.id -%}
                                               {%- assign is_current = true -%}
                                           {%- endif -%}

                                           <option value="{{ loc.url_to_set_as_current }}" {% if is_current %}selected{% endif %}>
                                               {{ loc.name }}
                                           </option>
                                       {%- endfor -%}
                                   </select>
                                   <noscript>
                                       <p><em>JavaScript is required for the dropdown. Use the links below:</em></p>
                                   </noscript>
                               </form>

                               <div class="b2b-location-links" style="margin-bottom: 1rem;">
                                   <ul>
                                       {%- for loc in customer.company_available_locations -%}
                                           {%- if current_loc and loc.id == current_loc.id -%}
                                               <li><strong>{{ loc.name }}</strong> <em>(current)</em></li>
                                           {%- else -%}
                                               <li><a href="{{ loc.url_to_set_as_current }}">{{ loc.name }}</a></li>
                                           {%- endif -%}
                                       {%- endfor -%}
                                   </ul>
                               </div>

                           {%- else -%}
                               <p><em>No available company locations found for this customer.</em></p>
                           {%- endif -%}

                           <hr>
               {% endcomment %}